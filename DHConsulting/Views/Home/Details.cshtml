@model DHConsulting.Models.Prodotto

@{
    ViewBag.Title = "Dettagli";
    TempData["IdProdotto"] = ViewContext.RouteData.Values["id"];
    List<int> pz = new List<int> { 1, 2, 3, 4, 5 };
    var cliente = ViewBag.Cliente as DHConsulting.Models.Cliente;
    var lista = ViewBag.Prodotti as List<DHConsulting.Models.Prodotto>;

    string packageType = "";
    string iconClass = "";
    string badgeClass = "";

    if (Model.Costo < 200)
    {
        packageType = "Pacchetto Basic";
        iconClass = "fa-solid fa-lightbulb text-4xl text-green-600";
        badgeClass = "bg-green-100 border-green-200";
    }
    else if (Model.Costo < 800)
    {
        packageType = "Pacchetto Plus";
        iconClass = "fa-solid fa-rocket text-4xl text-yellow-600";
        badgeClass = "bg-yellow-100 border-yellow-300";
    }
    else
    {
        packageType = "Pacchetto Professional";
        iconClass = "fa-solid fa-crown text-4xl text-yellow-400";
        badgeClass = "bg-gray-800 border-gray-600";
    }
}

@if (TempData["Successo"] != null)
{
    <div class="flex justify-center py-12">
        <div class="flex w-full max-w-md overflow-hidden rounded-lg shadow-md border border-blue-500">
            <div class="flex items-center justify-center w-12 bg-blue-500">
                <svg class="w-6 h-6 text-white fill-current" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 3.33331C10.8 3.33331 3.33337 10.8 3.33337 20C3.33337 29.2 10.8 36.6666 20 36.6666C29.2 36.6666 36.6667 29.2 36.6667 20C36.6667 10.8 29.2 3.33331 20 3.33331ZM16.6667 28.3333L8.33337 20L10.6834 17.65L16.6667 23.6166L29.3167 10.9666L31.6667 13.3333L16.6667 28.3333Z" />
                </svg>
            </div>
            <div class="px-4 py-2 -mx-3">
                <div class="mx-3">
                    <span class="font-semibold text-blue-500">Complimenti</span>
                    <p class="text-sm">@TempData["Successo"]</p>
                </div>
            </div>
        </div>
    </div>
}

@if (TempData["Errore"] != null)
{
    <div class="flex justify-center py-12">
        <div class="flex w-full max-w-md overflow-hidden rounded-lg shadow-md border border-red-500">
            <div class="flex items-center justify-center w-12 bg-red-500">
                <svg class="w-6 h-6 text-white fill-current" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 3.36667C10.8167 3.36667 3.3667 10.8167 3.3667 20C3.3667 29.1833 10.8167 36.6333 20 36.6333C29.1834 36.6333 36.6334 29.1833 36.6334 20C36.6334 10.8167 29.1834 3.36667 20 3.36667ZM19.1334 33.3333V22.9H13.3334L21.6667 6.66667V17.1H27.25L19.1334 33.3333Z" />
                </svg>
            </div>
            <div class="px-4 py-2 -mx-3">
                <div class="mx-3">
                    <span class="font-semibold text-red-500">Attenzione</span>
                    <p class="text-sm">@TempData["Errore"]</p>
                </div>
            </div>
        </div>
    </div>
}

<!-- Product Detail Hero -->
<section class="py-24 bg-gradient-to-br from-gray-50 via-gray-100 to-gray-200">
    <div class="container mx-auto px-4">
        <div class="max-w-6xl mx-auto">
            <!-- Breadcrumb -->
            <nav class="flex mb-8" aria-label="Breadcrumb">
                <ol class="inline-flex items-center space-x-1 md:space-x-3">
                    <li class="inline-flex items-center">
                        <a href="@Url.Action("Index", "Home")" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-yellow-600">
                            <i class="fa-solid fa-home mr-2"></i>
                            Home
                        </a>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <i class="fa-solid fa-chevron-right text-gray-400 mx-2"></i>
                            <span class="text-sm font-medium text-gray-500">@packageType</span>
                        </div>
                    </li>
                </ol>
            </nav>

            <div class="grid lg:grid-cols-2 gap-12 items-center">
                <!-- Product Image -->
                <div class="relative" data-aos="fade-right">
                    <div class="aspect-square bg-white rounded-3xl shadow-2xl p-8 border border-gray-200">
                        <img src="~/Content/Img/@Model.Image" alt="@packageType" class="w-full h-full object-cover rounded-2xl">

                        <!-- Floating Badge -->
                        <div class="absolute -top-4 -right-4">
                            <div class="w-24 h-24 @badgeClass rounded-full flex items-center justify-center border-4 shadow-lg">
                                <i class="@iconClass"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Product Info -->
                <div data-aos="fade-left">
                    <!-- Tags -->
                    <div class="flex flex-wrap gap-2 mb-6">
                        <span class="px-4 py-2 bg-purple-100 text-purple-700 rounded-full text-sm font-semibold">Tech</span>
                        <span class="px-4 py-2 bg-blue-100 text-blue-700 rounded-full text-sm font-semibold">Consulenza</span>
                        @if (Model.Costo > 700)
                        {
                            <span class="px-4 py-2 bg-emerald-100 text-emerald-700 rounded-full text-sm font-semibold">Sito</span>
                        }
                    </div>

                    <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6">@packageType</h1>

                    <p class="text-xl text-gray-600 mb-8 leading-relaxed">@Model.DescrizioneLunga</p>

                    <!-- Price -->
                    <div class="mb-8">
                        @if (Model.CostoScontato.HasValue)
                        {
                            <div class="flex items-end gap-3 mb-4">
                                <span class="text-2xl text-gray-400 line-through">€@Model.Costo</span>
                                <span class="text-5xl font-bold text-gray-900">€@Model.CostoScontato</span>
                            </div>
                        }
                        else
                        {
                            <span class="text-5xl font-bold text-gray-900">€@Model.Costo</span>
                        }
                        <span class="text-gray-500 text-lg ml-2">/ @(Model.Costo > 700 ? "sito" : Model.Costo < 800 ? "progetto" : "sessione")</span>
                    </div>

                    <!-- Features List -->
                    <div class="mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">Cosa Include:</h3>
                        <ul class="space-y-3">
                            <li class="flex items-center">
                                <i class="fa-solid fa-check text-@(Model.Costo < 200 ? "green" : Model.Costo < 800 ? "yellow" : "gray")-500 mr-3 text-lg"></i>
                                <span class="text-gray-700">Consulenza one-to-one (1h)</span>
                            </li>
                            <li class="flex items-center">
                                <i class="fa-solid fa-check text-@(Model.Costo < 200 ? "green" : Model.Costo < 800 ? "yellow" : "gray")-500 mr-3 text-lg"></i>
                                <span class="text-gray-700">Analisi di fattibilità completa</span>
                            </li>
                            <li class="flex items-center">
                                <i class="fa-solid fa-check text-@(Model.Costo < 200 ? "green" : Model.Costo < 800 ? "yellow" : "gray")-500 mr-3 text-lg"></i>
                                <span class="text-gray-700">PDF di riepilogo dettagliato</span>
                            </li>
                            <li class="flex items-center">
                                <i class="fa-solid fa-check text-@(Model.Costo < 200 ? "green" : Model.Costo < 800 ? "yellow" : "gray")-500 mr-3 text-lg"></i>
                                <span class="text-gray-700">Roadmap strategica</span>
                            </li>
                            @if (Model.Costo >= 200)
                            {
                                <li class="flex items-center">
                                    <i class="fa-solid fa-check text-@(Model.Costo < 800 ? "yellow" : "gray")-500 mr-3 text-lg"></i>
                                    <span class="text-gray-700">@(Model.Costo < 800 ? "Consulenze multiple (3 sessioni)" : "Tutto dei pacchetti precedenti")</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fa-solid fa-check text-@(Model.Costo < 800 ? "yellow" : "gray")-500 mr-3 text-lg"></i>
                                    <span class="text-gray-700">@(Model.Costo < 800 ? "Analisi competitive dettagliata" : "Sito web completo responsive")</span>
                                </li>
                                if (Model.Costo < 800)
                                {
                                    <li class="flex items-center">
                                        <i class="fa-solid fa-check text-yellow-500 mr-3 text-lg"></i>
                                        <span class="text-gray-700">Prototipo wireframe</span>
                                    </li>
                                    <li class="flex items-center">
                                        <i class="fa-solid fa-check text-yellow-500 mr-3 text-lg"></i>
                                        <span class="text-gray-700">Piano di implementazione</span>
                                    </li>
                                }
                            }
                            @if (Model.Costo >= 800)
                            {
                                <li class="flex items-center">
                                    <i class="fa-solid fa-check text-gray-700 mr-3 text-lg"></i>
                                    <span class="text-gray-700">3 revisioni incluse</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fa-solid fa-check text-gray-700 mr-3 text-lg"></i>
                                    <span class="text-gray-700">SEO optimization</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fa-solid fa-check text-gray-700 mr-3 text-lg"></i>
                                    <span class="text-gray-700">6 mesi di supporto gratuito</span>
                                </li>
                            }
                        </ul>
                    </div>

                    <!-- Action Buttons -->
                    @if (Model.Costo < 800)
                    {
                        <div class="bg-white rounded-2xl p-6 border-2 border-gray-200 shadow-lg">
                            @using (Html.BeginForm("AddProdotto", "Home", FormMethod.Post, new { @class = "flex flex-col gap-4" }))
                            {
                                @Html.AntiForgeryToken()
                                <div class="flex items-center justify-between">
                                    <label class="text-lg font-semibold text-gray-800">Quantità:</label>
                                    @Html.DropDownList("Quantita", new SelectList(pz), new { @class = "select select-bordered w-24" })
                                </div>

                                <button type="submit" class="btn btn-primary btn-lg w-full">
                                    <i class="fa-solid fa-cart-plus mr-2"></i>
                                    Aggiungi al Carrello
                                </button>
                            }

                            <div class="divider">oppure</div>

                            <a href="@Url.Action("Cart", "Payment")" class="btn btn-outline-primary btn-lg w-full">
                                <i class="fa-brands fa-paypal mr-2"></i>
                                Procedi al Checkout
                            </a>
                        </div>
                    }
                    else
                    {                      
                        <div class="bg-white rounded-2xl p-6 border-2 border-gray-200 shadow-lg">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4">Descrivi il Tuo Progetto</h4>
                            @using (Html.BeginForm("ProfessionalPack", "Home", FormMethod.Post, new { @class = "space-y-4" }))
                            {
                                <textarea rows="5"
                                            class="textarea textarea-bordered w-full"
                                            placeholder="Descrivi brevemente la tua idea o il tuo progetto da realizzare. Verrai ricontattato per maggiori dettagli."
                                            id="description"
                                            name="description"
                                            required></textarea>

                                <button type="submit" class="btn btn-primary btn-lg w-full">
                                    <i class="fa-solid fa-paper-plane mr-2"></i>
                                    Invia Richiesta
                                </button>
                            }
                        </div>                           
                    }
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Related Products Section -->
@if (lista != null && lista.Any())
{
    <section class="py-24 bg-white">
        <div class="container mx-auto px-4">
            <div class="max-w-6xl mx-auto">
                <div class="text-center mb-16" data-aos="fade-up">
                    <h2 class="text-3xl font-bold text-gray-900 mb-4">Prodotti Correlati</h2>
                    <p class="text-gray-600">Scopri altri pacchetti che potrebbero interessarti</p>
                </div>

                <div class="grid md:grid-cols-2 gap-8">
                    @foreach (var prodotto in lista)
                    {
                        string relatedPackageType = "";
                        string relatedIconClass = "";

                        if (prodotto.Costo < 200)
                        {
                            relatedPackageType = "Pacchetto Basic";
                            relatedIconClass = "fa-solid fa-lightbulb text-2xl text-green-600";
                        }
                        else if (prodotto.Costo < 800)
                        {
                            relatedPackageType = "Pacchetto Plus";
                            relatedIconClass = "fa-solid fa-rocket text-2xl text-yellow-600";
                        }
                        else
                        {
                            relatedPackageType = "Pacchetto Professional";
                            relatedIconClass = "fa-solid fa-crown text-2xl text-gray-700";
                        }

                        <div class="bg-white rounded-2xl p-6 border border-gray-200 shadow-lg hover-lift" data-aos="fade-up">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mr-4">
                                    <i class="@relatedIconClass"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-900">@relatedPackageType</h3>
                                    <p class="text-sm text-gray-600">@prodotto.DescrizioneBreve</p>
                                </div>
                            </div>

                            <div class="mb-4">
                                @if (prodotto.CostoScontato.HasValue)
                                {
                                    <div class="flex items-center gap-2">
                                        <span class="text-lg text-gray-400 line-through">€@prodotto.Costo</span>
                                        <span class="text-2xl font-bold text-gray-900">€@prodotto.CostoScontato</span>
                                    </div>
                                }
                                else
                                {
                                    <span class="text-2xl font-bold text-gray-900"><span class="text-gray-500 text-lg">@(prodotto.Costo > 700 ? "da " : "")</span>€@prodotto.Costo</span>
                                }
                            </div>

                            <a href="@Url.Action("Details", "Home", new { id = prodotto.IdProdotto })" class="btn btn-outline-primary w-full">
                                Scopri di Più
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>
    </section>
}

<!-- Additional Info Section -->
<section class="py-24 bg-gray-50">
    <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-3xl font-bold text-gray-900 mb-8" data-aos="fade-up">Garanzie e Sicurezza</h2>

            <div class="grid md:grid-cols-3 gap-8">
                <div class="text-center" data-aos="fade-up" data-aos-delay="100">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa-solid fa-circle-check text-2xl text-green-600"></i>
                    </div>
                    <h3 class="font-bold text-gray-900 mb-2">Soddisfatti o Rimborsati</h3>
                    <p class="text-gray-600">Garanzia 100% sul risultato del nostro lavoro</p>
                </div>

                <div class="text-center" data-aos="fade-up" data-aos-delay="200">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa-solid fa-headset text-2xl text-blue-600"></i>
                    </div>
                    <h3 class="font-bold text-gray-900 mb-2">Supporto 24/7</h3>
                    <p class="text-gray-600">Assistenza continua per tutti i nostri clienti</p>
                </div>

                <div class="text-center" data-aos="fade-up" data-aos-delay="300">
                    <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa-solid fa-clock text-2xl text-yellow-600"></i>
                    </div>
                    <h3 class="font-bold text-gray-900 mb-2">Consegna Puntuale</h3>
                    <p class="text-gray-600">Rispettiamo sempre i tempi concordati</p>
                </div>
            </div>
        </div>
    </div>
</section>

@section scripts {
    <style>
        .tooltip {
            position: relative;
        }

            .tooltip:hover .tooltip-text {
                opacity: 1;
                pointer-events: auto;
            }

        .tooltip-text {
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 1000;
        }

            .tooltip-text::after {
                content: "";
                position: absolute;
                top: 100%;
                left: 50%;
                margin-left: -5px;
                border-width: 5px;
                border-style: solid;
                border-color: rgba(0, 0, 0, 0.8) transparent transparent transparent;
            }
    </style>
}